<html>
    <head>
      <meta charset="UTF-8">
      <title>Chat</title>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/material-design-icons/3.0.1/iconfont/material-icons.min.css">
      <link rel="stylesheet" href="index.css">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.0/socket.io.min.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    </head>
<body>
    <div class="container">
        <div class="row no-gutters">
          <div class="col-md-4 border-right">
            <div class="settings-tray">
              <img class="profile-image" src="https://picsum.photos/100/100?id=0" alt="Profile img">
              <span class="settings-tray--right">
                <i class="material-icons">cached</i>
                <i class="material-icons">message</i>
                <i class="material-icons">menu</i>
              </span>
            </div>
            <div class="search-box">
              <div class="input-wrapper">
                <i class="material-icons">search</i>
                <input placeholder="Search here" type="text">
              </div>
            </div>
            <div class="vh-80 scroll_box" id="div_user_list">
            
            </div>
          </div>
          <div class="col-md-8">
            <div class="settings-tray">
                <div class="d-flex justify-content-between">
                <div class="friend-drawer no-gutters friend-drawer--grey">
                    <img class="profile-image" src="https://picsum.photos/100/100?id=7" alt="">
                    <div class="text">
                        <h6>Robo Cop</h6>
                        <p class="text-muted">Layin' down the law since like before Christ...</p>
                    </div>
                </div>
                <span class="settings-tray--right">
                    <i class="material-icons">cached</i>
                    <i class="material-icons">message</i>
                    <i class="material-icons">menu</i>
                  </span>
                </div>
            </div>
            <div class="chat-panel">
              <div class="row no-gutters">
                <div class="col-md-3">
                  <div class="chat-bubble chat-bubble--left">
                    Hello dude!
                  </div>
                </div>
              </div>
              <div class="row no-gutters">
                <div class="col-md-3 offset-md-9">
                  <div class="chat-bubble chat-bubble--right">
                    Hello dude!
                  </div>
                </div>
              </div>
              <div class="row no-gutters">
                <div class="col-md-3 offset-md-9">
                  <div class="chat-bubble chat-bubble--right">
                    Hello dude!
                  </div>
                </div>
              </div>
              <div class="row no-gutters">
                <div class="col-md-3">
                  <div class="chat-bubble chat-bubble--left">
                    Hello dude!
                  </div>
                </div>
              </div>
              <div class="row no-gutters">
                <div class="col-md-3">
                  <div class="chat-bubble chat-bubble--left">
                    Hello dude!
                  </div>
                </div>
              </div>
              <div class="row no-gutters">
                <div class="col-md-3">
                  <div class="chat-bubble chat-bubble--left">
                    Hello dude!
                  </div>
                </div>
              </div>
              <div class="row no-gutters">
                <div class="col-md-3 offset-md-9">
                  <div class="chat-bubble chat-bubble--right">
                    Hello dude!
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-12">
                  <div class="chat-box-tray">
                    <i class="material-icons">sentiment_very_satisfied</i>
                    <input type="text" placeholder="Type your message here...">
                    <i class="material-icons">mic</i>
                    <i class="material-icons">send</i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <script>

        const socket = io({
          auth: {
            token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjo5OTk5OTksInJvbGUiOiJjcyIsImlhdCI6MTYzODg4NTkwOCwiZXhwIjoxNjQyODA5OTA4fQ.jnfKxpR0fxwdCg-rEqpJc1xIWNiaozEq4a0WkRGK624"
          }
        });

        var online_tickets = [];

        socket.on('news', function(msg) {
          var item = document.createElement('li');
          item.textContent = msg.msg + " receiverUserId: " + msg.receiverUserId + " sender: " + msg.sender;
          messages.appendChild(item);
          window.scrollTo(0, document.body.scrollHeight);
        });
      
        socket.on('old_tickets', function(tickets) {
          console.log("old_tickets: " + JSON.stringify(tickets))
          online_tickets = [];
          for (const ticket of tickets) {
            online_tickets.push(ticket.userId);
            $("#div_user_list").append(`<div class="friend-drawer friend-drawer--onhover">
            <img class="profile-image" src="https://picsum.photos/100/100?id=1" alt="">
            <div class="text">
              <h6>${ticket.userName}</h6>
              <p class="text-muted">Hi guy!</p>
            </div>
            <span class="time text-muted small">13:21</span>
          </div>
          <hr>`);
          } 
        });
      
        socket.on('add_ticket_user', function(ticket) {
          var index = online_tickets.indexOf(ticket.userId);
          console.log("add_ticket_user: " + JSON.stringify(ticket) + " index: " + index);

          
          if(index < 0) {
            online_tickets.push(ticket.userId);
            $("#div_user_list").append(`<div class="friend-drawer friend-drawer--onhover">
            <img class="profile-image" src="https://picsum.photos/100/100?id=1" alt="">
            <div class="text">
              <h6>${ticket.userName}</h6>
              <p class="text-muted">Hi guy!</p>
            </div>
            <span class="time text-muted small">13:21</span>
          </div>
          <hr>`);
          }
        });
      
        socket.on('remove_ticket_user', function(ticket) {
          console.log("remove_ticket_user: " + JSON.stringify(ticket))
        });
      </script>
</body>
</html>